!function(i){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],i):i(jQuery)}(function(x){"use strict";x.jgrid.extend({setSubGrid:function(){return this.each(function(){var i,s,e=this,d=x.jgrid.styleUI[e.p.styleUI||"jQueryUI"].subgrid,d={plusicon:d.icon_plus,minusicon:d.icon_minus,openicon:d.icon_open,expandOnLoad:!1,selectOnExpand:!1,selectOnCollapse:!1,reloadOnExpand:!0,onErrorLoadData:null};if(e.p.subGridOptions=x.extend(d,e.p.subGridOptions||{}),e.p.colNames.unshift(""),e.p.colModel.unshift({name:"subgrid",width:x.jgrid.cell_width?e.p.subGridWidth+e.p.cellLayout:e.p.subGridWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0}),(i=e.p.subGridModel)[0])for(i[0].align=x.extend([],i[0].align||[]),s=0;s<i[0].name.length;s++)i[0].align[s]=i[0].align[s]||"left"})},addSubGridCell:function(i,s){var e,d,r,t="";return this.each(function(){t=this.formatCol(i,s),d=this.p.id,e=this.p.subGridOptions.plusicon,r=x.jgrid.styleUI[this.p.styleUI||"jQueryUI"].common}),'<td role="gridcell" aria-describedby="'+d+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+t+"><a style='cursor:pointer;' class='ui-sghref'><span class='"+r.icon_base+" "+e+"'></span></a></td>"},addSubGrid:function(m,j){return this.each(function(){var u=this;if(u.grid){var s,e,d,r,t,i,n,c=x.jgrid.styleUI[u.p.styleUI||"jQueryUI"].base,g=x.jgrid.styleUI[u.p.styleUI||"jQueryUI"].common,a=x.jgrid.getRegional(this,"errors"),b=function(i,s,e){e=x("<td align='"+u.p.subGridModel[0].align[e]+"'></td>").html(s);x(i).append(e)},l=function(i,s){for(var e,d,r=x("<table class='"+c.rowTable+" ui-common-table'><tbody></tbody></table>"),t=x("<tr></tr>"),n=0;n<u.p.subGridModel[0].name.length;n++)e=x("<th class='"+c.headerBox+" ui-th-subgrid ui-th-column ui-th-"+u.p.direction+"'></th>"),x(e).html(u.p.subGridModel[0].name[n]),x(e).width(u.p.subGridModel[0].width[n]),x(t).append(e);x(r).append(t),i&&(d=u.p.xmlReader.subgrid,x(d.root+" "+d.row,i).each(function(){if(t=x("<tr class='"+g.content+" ui-subtblcell'></tr>"),!0===d.repeatitems)x(d.cell,this).each(function(i){b(t,x(this).text()||"&#160;",i)});else{var i=u.p.subGridModel[0].mapping||u.p.subGridModel[0].name;if(i)for(n=0;n<i.length;n++)b(t,x.jgrid.getXmlData(this,i[n])||"&#160;",n)}x(r).append(t)}));i=x(u.grid.bDiv).find("table").first().attr("id")+"_";return x("#"+x.jgrid.jqID(i+s)).append(r),u.grid.hDiv.loading=!1,x("#load_"+x.jgrid.jqID(u.p.id)).hide(),!1},o=function(i,s){for(var e,d,r,t,n,a=x("<table class='"+c.rowTable+" ui-common-table'><tbody></tbody></table>"),l=x("<tr></tr>"),o=0;o<u.p.subGridModel[0].name.length;o++)e=x("<th class='"+c.headerBox+" ui-th-subgrid ui-th-column ui-th-"+u.p.direction+"'></th>"),x(e).html(u.p.subGridModel[0].name[o]),x(e).width(u.p.subGridModel[0].width[o]),x(l).append(e);if(x(a).append(l),i&&(t=u.p.jsonReader.subgrid,void 0!==(d=x.jgrid.getAccessor(i,t.root))))for(o=0;o<d.length;o++){if(r=d[o],l=x("<tr class='"+g.content+" ui-subtblcell'></tr>"),!0===t.repeatitems)for(t.cell&&(r=r[t.cell]),n=0;n<r.length;n++)b(l,r[n]||"&#160;",n);else{var p=u.p.subGridModel[0].mapping||u.p.subGridModel[0].name;if(p.length)for(n=0;n<p.length;n++)b(l,x.jgrid.getAccessor(r,p[n])||"&#160;",n)}x(a).append(l)}i=x(u.grid.bDiv).find("table").first().attr("id")+"_";return x("#"+x.jgrid.jqID(i+s)).append(a),u.grid.hDiv.loading=!1,x("#load_"+x.jgrid.jqID(u.p.id)).hide(),!1},p=0,h=(x.each(u.p.colModel,function(){!0!==this.hidden&&"rn"!==this.name&&"cb"!==this.name&&"sc"!==this.name||p++}),u.rows.length),f=1,G=x.jgrid.isFunction(u.p.isHasSubGrid);for(void 0!==j&&0<j&&(h=(f=j)+1);f<h;)x(u.rows[f]).hasClass("jqgrow")&&(u.p.scroll&&x(u.rows[f].cells[m]).off("click"),i=null,!1===(i=G?u.p.isHasSubGrid.call(u,u.rows[f].id):i)?u.rows[f].cells[m].innerHTML="":x(u.rows[f].cells[m]).on("click",function(){var i=x(this).parent("tr")[0];if(e=u.p.id,s=i.id,t=x("#"+e+"_"+s+"_expandedContent"),x(this).hasClass("sgcollapsed")){if(!1===(r=(r=!1!==(r=x(u).triggerHandler("jqGridSubGridBeforeExpand",[e+"_"+s,s]))&&"stop"!==r)&&x.jgrid.isFunction(u.p.subGridBeforeExpand)?u.p.subGridBeforeExpand.call(u,e+"_"+s,s):r))return!1;!0===u.p.subGridOptions.reloadOnExpand||!1===u.p.subGridOptions.reloadOnExpand&&!t.hasClass("ui-subgrid")?(d=1<=m?"<td colspan='"+m+"'>&#160;</td>":"",x(i).after("<tr role='row' id='"+e+"_"+s+"_expandedContent' class='ui-subgrid ui-sg-expanded'>"+d+"<td class='"+g.content+" subgrid-cell'><span class='"+g.icon_base+" "+u.p.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(u.p.colNames.length-1-p,10)+"' class='"+g.content+" subgrid-data'><div id="+e+"_"+s+" class='tablediv'></div></td></tr>"),x(u).triggerHandler("jqGridSubGridRowExpanded",[e+"_"+s,s]),x.jgrid.isFunction(u.p.subGridRowExpanded)?u.p.subGridRowExpanded.call(u,e+"_"+s,s):function(i){var s,e,d=x(i).attr("id"),r={nd_:(new Date).getTime()};if(r[u.p.prmNames.subgridid]=d,!u.p.subGridModel[0])return;if(u.p.subGridModel[0].params)for(e=0;e<u.p.subGridModel[0].params.length;e++)for(s=0;s<u.p.colModel.length;s++)u.p.colModel[s].name===u.p.subGridModel[0].params[e]&&(r[u.p.colModel[s].name]=x("td",i).eq(s).text().replace(/\&#160\;/gi,""));if(!u.grid.hDiv.loading)switch(u.grid.hDiv.loading=!0,x("#load_"+x.jgrid.jqID(u.p.id)).show(),u.p.subgridtype||(u.p.subgridtype=u.p.datatype),x.jgrid.isFunction(u.p.subgridtype)?u.p.subgridtype.call(u,r):u.p.subgridtype=u.p.subgridtype.toLowerCase(),u.p.subgridtype){case"xml":case"json":x.ajax(x.extend({type:u.p.mtype,url:x.jgrid.isFunction(u.p.subGridUrl)?u.p.subGridUrl.call(u,r):u.p.subGridUrl,dataType:u.p.subgridtype,data:x.jgrid.isFunction(u.p.serializeSubGridData)?u.p.serializeSubGridData.call(u,r):r,success:function(i,s,e){"xml"===u.p.subgridtype?l(e.responseXML,d):o(x.jgrid.parse(e.responseText),d)},error:function(i,s,e){if(x.jgrid.isFunction(u.p.subGridOptions.onErrorLoadData))u.p.subGridOptions.onErrorLoadData.call(u,rowid,i,s,e);else{s=i.responseText+" <br/>"+i.statusText;try{x.jgrid.info_dialog(a.errcap,'<div class="'+g.error+'">'+s+"</div>",edit.bClose,{buttonalign:"right",styleUI:u.p.styleUI})}catch(i){alert(s)}}}},x.jgrid.ajaxOptions,u.p.ajaxSubgridOptions||{}))}}(i)):t.show().removeClass("ui-sg-collapsed").addClass("ui-sg-expanded"),x(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+g.icon_base+" "+u.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded"),u.p.subGridOptions.selectOnExpand&&x(u).jqGrid("setSelection",s)}else if(x(this).hasClass("sgexpanded")){if(!1===(r=(r=!1!==(r=x(u).triggerHandler("jqGridSubGridRowColapsed",[e+"_"+s,s]))&&"stop"!==r)&&x.jgrid.isFunction(u.p.subGridRowColapsed)?u.p.subGridRowColapsed.call(u,e+"_"+s,s):r))return!1;!0===u.p.subGridOptions.reloadOnExpand?t.remove(".ui-subgrid"):t.hasClass("ui-subgrid")&&t.hide().addClass("ui-sg-collapsed").removeClass("ui-sg-expanded"),x(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+g.icon_base+" "+u.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed"),u.p.subGridOptions.selectOnCollapse&&x(u).jqGrid("setSelection",s)}return!1})),f++;!0===u.p.subGridOptions.expandOnLoad&&(n=0,u.p.multiselect&&n++,u.p.rownumbers&&n++,x(u.rows).filter(".jqgrow").each(function(i,s){x(s.cells[n]).click()})),u.subGridXml=function(i,s){l(i,s)},u.subGridJson=function(i,s){o(i,s)}}})},expandSubGridRow:function(s){return this.each(function(){var i;(this.grid||s)&&!0===this.p.subGrid&&(i=x(this).jqGrid("getInd",s,!0))&&(i=x("td.sgcollapsed",i)[0])&&x(i).trigger("click")})},collapseSubGridRow:function(s){return this.each(function(){var i;(this.grid||s)&&!0===this.p.subGrid&&(i=x(this).jqGrid("getInd",s,!0))&&(i=x("td.sgexpanded",i)[0])&&x(i).trigger("click")})},toggleSubGridRow:function(e){return this.each(function(){var i,s;(this.grid||e)&&!0===this.p.subGrid&&(i=x(this).jqGrid("getInd",e,!0))&&(s=(s=x("td.sgcollapsed",i)[0])||x("td.sgexpanded",i)[0])&&x(s).trigger("click")})}})});